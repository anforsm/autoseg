{
    "model": {
        "class": "UNETR",
        "hf_path": null,
        "hyperparameters": {
            "in_channels": 1,
            "output_shapes": [
                3,
                10
            ]
        },
        "name": "UNet s1",
        "path": "checkpoints/UNet s1/"
    },
    "pipeline": {
        "_order": [
            "source",
            "normalize",
            "augment",
            "target",
            "post",
            "lsd_target"
        ],
        "_outputs": [
            "RAW",
            "LABELS",
            "GT_AFFS",
            "AFFS_WEIGHTS",
            "GT_AFFS_MASK",
            "LABELS_MASK",
            "GT_LSDS",
            "LSDS_WEIGHTS"
        ],
        "_voxel_size": [
            50,
            4,
            4
        ],
        "augment": [
            {
                "elastic_augment": {
                    "control_point_spacing": [
                        1,
                        50,
                        50
                    ],
                    "jitter_sigma": [
                        0,
                        5,
                        5
                    ],
                    "rotation_interval": [
                        0,
                        1.570796
                    ],
                    "scale_interval": [
                        0.9,
                        1.1
                    ],
                    "subsample": 4
                }
            },
            {
                "simple_augment": {
                    "transpose_only": [
                        1,
                        2
                    ]
                }
            },
            {
                "noise_augment": {
                    "array": "RAW"
                }
            },
            {
                "intensity_augment": {
                    "array": "RAW",
                    "scale_max": 1.1,
                    "scale_min": 0.9,
                    "shift_max": 0.1,
                    "shift_min": -0.1
                }
            },
            {
                "smooth_array": {
                    "array": "RAW"
                }
            },
            {
                "grow_boundary": {
                    "labels": "LABELS",
                    "only_xy": true
                }
            }
        ],
        "lsd_target": [
            {
                "add_local_shape_descriptor": {
                    "descriptor": "GT_LSDS",
                    "labels_mask": "LABELS_MASK",
                    "lsds_mask": "LSDS_WEIGHTS",
                    "segmentation": "LABELS",
                    "sigma": 80
                }
            }
        ],
        "normalize": [
            {
                "normalize": {
                    "array": "RAW"
                }
            }
        ],
        "post": [
            {
                "intensity_scale_shift": {
                    "array": "RAW",
                    "scale": 2,
                    "shift": -1
                }
            },
            {
                "unsqueeze": {
                    "arrays": [
                        "RAW"
                    ],
                    "axis": 0
                }
            }
        ],
        "source": [
            [
                {
                    "zarr_source": {
                        "array_specs": {
                            "_labels_mask_original": {
                                "array_spec": {
                                    "interpolatable": false
                                }
                            },
                            "_labels_original": {
                                "array_spec": {
                                    "interpolatable": false
                                }
                            },
                            "_raw_original": {
                                "array_spec": {
                                    "interpolatable": true
                                }
                            }
                        },
                        "datasets": {
                            "_labels_mask_original": "labels_mask/s0",
                            "_labels_original": "labels/s0",
                            "_raw_original": "raw/s0"
                        },
                        "store": "SynapseWeb/kh2015/apical"
                    }
                },
                {
                    "resample": {
                        "source": "RAW_ORIGINAL",
                        "target": "RAW",
                        "target_voxel_size": {
                            "coordinate": {
                                "_positional": [
                                    50,
                                    4,
                                    4
                                ]
                            }
                        }
                    }
                },
                {
                    "resample": {
                        "source": "LABELS_ORIGINAL",
                        "target": "LABELS",
                        "target_voxel_size": {
                            "coordinate": {
                                "_positional": [
                                    50,
                                    4,
                                    4
                                ]
                            }
                        }
                    }
                },
                {
                    "resample": {
                        "source": "LABELS_MASK_ORIGINAL",
                        "target": "LABELS_MASK",
                        "target_voxel_size": {
                            "coordinate": {
                                "_positional": [
                                    50,
                                    4,
                                    4
                                ]
                            }
                        }
                    }
                },
                {
                    "pad": {
                        "key": "RAW",
                        "size": null
                    }
                },
                {
                    "pad": {
                        "key": "LABELS",
                        "size": {
                            "coordinate": {
                                "_positional": [
                                    450,
                                    304,
                                    304
                                ]
                            }
                        }
                    }
                },
                {
                    "pad": {
                        "key": "LABELS_MASK",
                        "size": {
                            "coordinate": {
                                "_positional": [
                                    450,
                                    304,
                                    304
                                ]
                            }
                        }
                    }
                },
                {
                    "random_location": {
                        "mask": "LABELS_MASK",
                        "min_masked": 0.7
                    }
                }
            ]
        ],
        "target": [
            {
                "add_affinities": {
                    "affinities": "GT_AFFS",
                    "affinities_mask": "GT_AFFS_MASK",
                    "affinity_neighborhood": [
                        [
                            -1,
                            0,
                            0
                        ],
                        [
                            0,
                            -1,
                            0
                        ],
                        [
                            0,
                            0,
                            -1
                        ]
                    ],
                    "labels": "LABELS",
                    "labels_mask": "LABELS_MASK"
                }
            },
            {
                "balance_labels": {
                    "labels": "GT_AFFS",
                    "mask": "GT_AFFS_MASK",
                    "scales": "AFFS_WEIGHTS"
                }
            }
        ]
    },
    "predict": {
        "multi_gpu": false,
        "num_workers": 6,
        "output": [
            {
                "dataset": "preds/affs",
                "num_channels": 3,
                "path": "predict_3gpu.zarr"
            }
        ],
        "outputs": [
            {
                "dataset": "preds/lsds",
                "num_channels": 10,
                "path": "multiout.zarr"
            }
        ],
        "shape_increase": [
            0,
            80,
            80
        ],
        "source": [
            {
                "dataset": "raw/s0",
                "path": "/home/anton/.cache/autoseg/datasets/SynapseWeb/kh2015/data/spine.zarr"
            }
        ]
    },
    "training": {
        "batch_outputs": [
            "raw",
            "labels",
            "gt_affs",
            "affs_weights",
            "affs_mask",
            "labels_mask",
            "gt_lsds",
            "lsds_weights"
        ],
        "learning_rate": 5e-05,
        "log_snapshot_every": 2500,
        "logging": {
            "log_images": [
                "raw",
                "labels",
                "gt_affs",
                "affs",
                "gt_lsds",
                "lsds"
            ],
            "wandb": false
        },
        "loss": {
            "_inputs": [
                "affs",
                "gt_affs",
                "affs_weights",
                "lsds",
                "gt_lsds",
                "lsds_weights"
            ],
            "weighted_m_s_e_loss": {}
        },
        "model_inputs": [
            "raw"
        ],
        "model_outputs": [
            "affs",
            "lsds"
        ],
        "multi_gpu": false,
        "num_val_samples": 100,
        "overwrite_checkpoints": false,
        "save_best": true,
        "save_every": 25000,
        "train_dataloader": {
            "batch_size": 1,
            "input_image_shape": [
                48,
                208,
                208
            ],
            "num_workers": 20,
            "output_image_shape": [
                48,
                208,
                208
            ],
            "parallel": true,
            "precache_per_worker": 2,
            "use_gunpowder_precache": true
        },
        "update_steps": 200000,
        "val_dataloader": {
            "batch_size": 1,
            "input_image_shape": [
                48,
                208,
                208
            ],
            "num_workers": 20,
            "output_image_shape": [
                48,
                208,
                208
            ],
            "parallel": false,
            "pipeline": {
                "_order": [
                    "source",
                    "normalize",
                    "target",
                    "post",
                    "lsd_target"
                ],
                "_outputs": [
                    "RAW",
                    "LABELS",
                    "GT_AFFS",
                    "AFFS_WEIGHTS",
                    "GT_AFFS_MASK",
                    "LABELS_MASK",
                    "GT_LSDS",
                    "LSDS_WEIGHTS"
                ],
                "lsd_target": [
                    {
                        "add_local_shape_descriptor": {
                            "descriptor": "GT_LSDS",
                            "labels_mask": "LABELS_MASK",
                            "lsds_mask": "LSDS_WEIGHTS",
                            "segmentation": "LABELS",
                            "sigma": 80
                        }
                    }
                ],
                "normalize": [
                    {
                        "normalize": {
                            "array": "RAW"
                        }
                    }
                ],
                "post": [
                    {
                        "intensity_scale_shift": {
                            "array": "RAW",
                            "scale": 2,
                            "shift": -1
                        }
                    },
                    {
                        "unsqueeze": {
                            "arrays": [
                                "RAW"
                            ],
                            "axis": 0
                        }
                    }
                ],
                "source": [
                    [
                        {
                            "zarr_source": {
                                "array_specs": {
                                    "_labels": {
                                        "array_spec": {
                                            "interpolatable": false
                                        }
                                    },
                                    "_labels_mask": {
                                        "array_spec": {
                                            "interpolatable": false
                                        }
                                    },
                                    "_raw": {
                                        "array_spec": {
                                            "interpolatable": true
                                        }
                                    }
                                },
                                "datasets": {
                                    "_labels": "labels/s0",
                                    "_labels_mask": "labels_mask/s0",
                                    "_raw": "raw/s0"
                                },
                                "store": "SynapseWeb/kh2015/oblique"
                            }
                        },
                        {
                            "pad": {
                                "key": "RAW",
                                "size": null
                            }
                        },
                        {
                            "pad": {
                                "key": "LABELS",
                                "size": {
                                    "coordinate": {
                                        "_positional": [
                                            450,
                                            290,
                                            290
                                        ]
                                    }
                                }
                            }
                        },
                        {
                            "pad": {
                                "key": "LABELS_MASK",
                                "size": {
                                    "coordinate": {
                                        "_positional": [
                                            450,
                                            290,
                                            290
                                        ]
                                    }
                                }
                            }
                        },
                        {
                            "random_location": {
                                "mask": "LABELS_MASK",
                                "min_masked": 0.7
                            }
                        }
                    ]
                ],
                "target": [
                    {
                        "add_affinities": {
                            "affinities": "GT_AFFS",
                            "affinities_mask": "GT_AFFS_MASK",
                            "affinity_neighborhood": [
                                [
                                    -1,
                                    0,
                                    0
                                ],
                                [
                                    0,
                                    -1,
                                    0
                                ],
                                [
                                    0,
                                    0,
                                    -1
                                ]
                            ],
                            "labels": "LABELS",
                            "labels_mask": "LABELS_MASK"
                        }
                    },
                    {
                        "balance_labels": {
                            "labels": "GT_AFFS",
                            "mask": "GT_AFFS_MASK",
                            "scales": "AFFS_WEIGHTS"
                        }
                    }
                ]
            },
            "precache_per_worker": 2,
            "use_gunpowder_precache": false
        },
        "val_log": 2500
    }
}
